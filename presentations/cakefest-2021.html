<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>CakePHP Fixture Factories</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/white.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
        section {
            font-family: 'Roboto', sans-serif;
            /*font-family: "Open Sans",Verdana,sans-serif!important;*/
        }
        .white-shadowed {
            color: white!important;
            text-shadow: 0 0 10px #000000!important;
        }
        .cakephp {
            color: #D33C44!important;
        }
        p.small {
            font-size: large;
        }
        .shadow {
            -webkit-box-shadow: 4px 6px 5px -4px rgba(0,0,0,0.75);
            -moz-box-shadow: 4px 6px 5px -4px rgba(0,0,0,0.75);
            box-shadow: 4px 6px 5px -4px rgba(0,0,0,0.75);
        }
        .slides {
            width: 1120px!important;
        }
        i {
            font-style: italic;
        }
        div.luxembourg {
            background: rgb(238,36,54);
            background: linear-gradient(0deg, rgba(238,36,54,1) 0%, rgba(255,255,255,1) 33%, rgba(255,255,255,1) 66%, rgba(0,156,215,1) 100%);
            padding: 50px;
            /*border: 3px solid lightgrey;*/
            /*border-radius: 15px;*/
        }
        td {
            font-size: smaller;
            text-align: center!important;
            vertical-align: middle!important;
            border-width: 0!important;
            padding: 10px!important;
        }
        tbody.large-margins td {
            padding: 30px!important;
        }
        .green {
            color: green;
        }
        .red {
            color: red;
        }
        .orange {
            color: orange;
        }
        .orange-framed {
            border-style: solid;
            border-color: orange;
            border-width: 2px;
        }
        .grey-framed {
            border-style: solid;
            border-color: grey;
            border-width: 2px;
        }
        .green-framed {
            border-style: solid;
            border-color: green;
            border-width: 2px;
        }
        footer {
            position: absolute;
            bottom: 0;
            left: 1em;
            font-size: 0.5em;
            width: 100%;
        }
        footer a {
            color: #0C0239!important;
        }
        .float-right {
            position:fixed;
            top:5%;
            z-index:9999;
            font-size: 0.8em;
            right:0;
        }
        .float-left {
            float: left;
            font-size: 0.5em;
            position: fixed;
            padding: 5px;
            font-weight: bold;
        }
        .mini {
            font-size: 1px;
        }
    </style>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <a href="https://passbolt.com" target="_blank"><img style="height: 40px; margin: 40px 0" src="assets/passbolt.png"></a>
            <h3>
                How does your <span class="cakephp">CAKE</span> test?
            </h3>
            <p class="small">by Juan Pablo Ramirez</p>
            <aside class="notes">
                Welcome to my presentation on how the Cake tastes a Passbolt.
            </aside>
        </section>
        <section>
            <section>
                <h3>Passbolt in a nutshell</h3>
                <p class="fragment">Who we are / What we do</p>

                <h3 class="fragment">Code insights</h3>
                <p>
                    <span class="fragment">Architecture</span>
                    <span class="fragment">/ Locale</span>
                    <span class="fragment">/ JWT Authentication<br></span>
                    <span class="fragment">Middlewares</span>
                    <span class="fragment">/ Dependency injection</span><br>
                </p>
                <h3 class="fragment">Testing tools</h3>
                <p>
                    <span class="fragment">Test Suite Light</span>
                    <span class="fragment">/ Fixtures Factories</span>
                </p>
                <aside class="notes">
                    Here is a quick overview of the presentation coming.
                    I'll briefly introduce Passbolt and the team.
                    I'll then pick some examples of the code of the API
                    to present how we use CakePHP, which is open to improvement suggestions.
                    Finally I'll re-introduce the test suite light and the fixture factories
                    which Mark Story already mentioned yesterday.
                </aside>
            </section>
        </section>
        <section>
            <section data-background="assets/cakefest21/Animated-devices-V2.svg" data-background-interactive>

                <h4 style="background-color: #00000000; padding: 40px ; opacity: 0.9">
                <p class="white-shadowed">
                    in a nutshell
                </p>
                </h4>
            </section>
            <section data-background="assets/passbolt_bg.jpg"></section>
            <section>
                <table>
                    <tbody class="large-margins">
                        <tr>
                            <td>Luxembourg</td>
                            <td>18 employees</td>
                            <td>>100K users</td>
                        </tr>
                        <tr class="fragment">
                            <td>Open source</td>
                            <td><a href="https://github.com/passbolt/passbolt_api" target="_blank">github.com/passbolt</a></td>
                            <td>OpenGPG</td>
                        </tr>
                        <tr class="fragment">
                            <td>Self-hosted</td>
                            <td>Entreprise</td>
                            <td>Cloud-hosted</td>
                        </tr>
                        <tr class="fragment">
                            <td>RESTFull API</td>
                            <td>Web extension</td>
                            <td>Mobile app</td>
                        </tr>
                        <tr class="fragment">
                            <td>Test driven</td>
                            <td>Security driven</td>
                            <td>Open source driven</td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <div>
                    <table>
                    <tbody>
                        <tr>
                            <td>
                                <small style="display: block">3 TECHNICAL LEADERS</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/14xNd7YClBLRio.gif"/>
                            </td>
                            <td>
                                <small style="display: block">1 PROJECT MANAGER</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/nGlhhVfcw561i.gif"/>
                            </td>
                            <td>
                                <small style="display: block">1 DESIGNER</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/6lsW1YMkojWrC.gif"/>
                            </td>
                        </tr>
                        <tr class="fragment fade-left">
                            <td>
                                <small style="display: block">1 SUPPORT</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/ghXliYqQb2BMI.gif"/>
                            </td>
                            <td>
                                <small style="display: block">COMMUNITY</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/l2Jejc2X9SRlxS8Zq.gif"/>
                            </td>
                            <td>
                                <small style="display: block">HR + MARKETING + CUSTOMER SUPPORT</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/w1otEhQ00WdWg.gif"/>
                            </td>
                        </tr>
                        <tr class="fragment fade-right">
                            <td>
                                <small style="display: block">2 BACK DEVS</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/2Y9FOGIqQU4H8yKnk4.gif"/>
                            </td>
                            <td>
                                <small style="display: block">2 FRONT DEVS</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/uYVRhh5pLevCM.gif"/>
                            </td>
                            <td>
                                <small style="display: block">2 SYSOPS</small>
                                <img height="150px" style="border: solid 1px whitesmoke; border-radius: 2px" src="http://i.giphy.com/O6cLcNr9HD6yk.gif"/>
                            </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
            </section>
            <section>
                <p>Meet us on the <a href="https://community.passbolt.com/" target="_blank">Passbolt Community Forum</a></p>
            </section>
            <section>
                <p>Check Remy's <a href="https://www.youtube.com/watch?v=xv6paiNn-_8" target="_blank">Cakefest 2020 keynote</a></p>
            </section>
        </section>
        <section>
            <h4>This year</h4>
            <table><tbody class="large-margins">
                <tr>
                    <td class="fragment">
                        CakePHP 3.8 to 4.2
                    </td>
                    <td class="fragment">
                        Security Audit
                    </td>
                </tr>
                <tr>
                    <td class="fragment">
                        PostgreSQL
                    </td>
                    <td class="fragment">
                        Locales (FR, DE and SE)
                    </td>
                </tr>
                <tr>
                    <td class="fragment">
                        JWT Authentication
                    </td>
                    <td class="fragment">
                        Dependency injection
                    </td>
                </tr>
                <tr>
                    <td class="fragment">
                        Fixture Factories
                    </td>
                    <td class="fragment">
                        PHPStan 6 + Psalm 4
                    </td>
                </tr>
            </tbody></table>
        </section>
        <section>
            <section>
                <p>
                    <img src="./assets/cakefest21/locale_login.png">
                </p>
                <aside class="notes">
                    A little word on the translations. We now cover french, and the coming v3.3 version
                    will feature Swedish and German. This is open to contributions.
                </aside>
            </section>
            <section>
                <p>
                    <a href="https://passbolt.crowdin.com/passbolt" target="_blank">
                        <img width="250px" src="assets/cakefest21/crowdin-logo-small-black.svg">
                    </a>
                </p>
                <aside class="notes">
                    Translations are made with the Crowdin application. Let's click this.
                    You can see the locales being now translated. You are free to contribute,
                    your bored uncle too. You can add new locales and you can bet on who will be
                    done first between chinese and polish!
                </aside>
            </section>
        </section>
        <section data-background="http://i.giphy.com/7FrOU9tPbgAZtxV5mb.gif" data-background-interactive>
            <p class="white-shadowed">Enter the code...</p>
            <aside class="notes">
                Let's now have some Cake...
            </aside>
        </section>
        <section>
            <section data-background="./assets/cakefest21/architecture.png">
                <h1 class="white-shadowed">
                    Architecture overview
                </h1>
                <aside class="notes">
                    The API architecture at Passbolt follows strictly the CakePHP conventions.
                    Controllers are slim and feature one single dedicated action.
                    Models are slim.
                    The business logic is placed in services.
                    Middlewares are useful.
                    Plugins are essentials.
                    Schema is handled with migrations. Around 24 tables in the community
                    edition, which is not huge.
                </aside>
            </section>
        </section>
        <section>
            <section data-background="assets/cakefest21/test_locale.png">
                <h1 class="white-shadowed">Locales</h1>
                <aside class="notes">
                    As mentioned previously, internationalization is a new feature. As every feature, it has it's own
                    plugin. Let's dive into it...
                </aside>
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">Translate emails subject</span>
                <span class="mini">testLocaleServiceLocaleTranslateString_With_French_Org_Setting</span>
                <a href="https://github.com/lorenzo/cakephp-email-queue" target="_blank"><br>EmailQueue</a>
                <img src="assets/cakefest21/test_locale.png">
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">Set emails locale</span>
                <span class="mini">testPreviewCommandLocale</span>
                <p><img src="assets/cakefest21/test_locale_cmd.png"></p>
            </section>
        </section>
        <section>
            <section data-background="./assets/cakefest21/jwt_auth_container.png">
                <h2 class="white-shadowed">
                    Json Web Token<br> Authentication
                </h2>
                <div class="baked-with-cakephp"></div>
                <aside class="notes">
                    JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained
                    way for securely transmitting information between parties as a JSON object.
                    This information can be verified and trusted because it is digitally signed.
                    JWTs can be signed using a secret (with the HMAC algorithm) or a public/private
                    key pair using RSA or ECDSA. (https://jwt.io/introduction)
                </aside>
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">JWT Authentication</span>
                <span class="mini">testResourcesAddSuccessWithJWT</span>
                <p><img src="assets/cakefest21/jwt_auth_test.png"></p>
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">Security Exceptions</span>
                <span class="mini">testJwtLoginControllerTest_Consumed_Verify_Token_Should_Send_An_Email</span>
                <img src="assets/cakefest21/jwt_exception.png">
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">Security Exceptions</span>
                <span class="mini">testAuthRefreshTokenControllerWithExpiredCookie_Should_Trigger_Bad_Request_And_Send_Emails</span>
                <img src="assets/cakefest21/jwt_exception_2.png">
            </section>
        </section>
        <section data-background-transition="zoom">
            <section data-background-color="#272A2A">
                <h2 class="white-shadowed" style="margin-top: 400px"><a href="https://github.com/vierge-noire" target="_blank">Vierge noire</a></h2>
                <p class="small white-shadowed">Juan Pablo Ramirez + Nicolas Masson</p>
            </section>
            <section data-background-color="#272A2A">
                <p><a href="https://github.com/vierge-noire/cakephp-test-migrator" target="_blank">CakePHP Migrator < 4.3</a><br>
                <p><a class="fragment" href="https://book.cakephp.org/4.next/en/development/testing.html#creating-test-database-schema" target="_blank">CakePHP Migrations > 4.3</a></p>
                <p><a class="fragment" href="https://github.com/vierge-noire/cakephp-test-suite-light" target="_blank">CakePHP Test Suite Light</a></p>
                <p><a class="fragment" href="https://github.com/vierge-noire/cakephp-fixture-factories" target="_blank">CakePHP Fixture Factories</a></p>
                <p><a class="fragment" href="https://github.com/vierge-noire/cakephp-behat-suite" target="_blank">CakePHP Behat Suite</a></p>
                <aside class="notes">
                    At Vierge Noire we have developed a few packages to ease the life of the test driven Bakers.

                </aside>
            </section>
            <section data-background-iframe="https://book.cakephp.org/4.next/en/development/testing.html#creating-test-database-schema" data-background-interactive>
                <div style="position: absolute; width: 200px; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(211, 60, 68, 0.7); padding: 20px; font-size: 20px; text-align: center;">
                    <h2 class="white-shadowed">Cookbook</h2>
                </div>
            </section>
        </section>
        <section>
            <section data-background="./assets/cakefest21/tsl.png">
                <h1 class="white-shadowed">Test Suite Light</h1>
                <aside class="notes">
                    If you wonder why we chose that name, feel free to break the ice with this question as the Q/A session.
                </aside>
            </section>
            <section data-background-color="#272A2A">
                <span style="display: inline-block">Sniffers</span>
                <span class="mini">testRecreateDirtyTableCollectorAfterDrop</span>
                <img src="assets/cakefest21/test_tsl.png">
            </section>
            <section data-background-color="#272A2A">
                <h3 class="white-shadowed">Let's go <span style="font-size: 5em">bigger</span></h3>
                <a href="https://github.com/vierge-noire/test-database-cleaner" target="_blank">Test Database Cleaner</a>
                <aside class="notes">
                    Der Tatort reiniger. This package will help manage the test DB in a Framework agnostic manner.
                </aside>
            </section>
        </section>
        <section>
            <section data-background="./assets/cakefest21/test_ff.png">
                <h1 class="white-shadowed">Fixture Factories</h1>
                <aside class="notes">
                    You've heard of the fixture factories since last year. The concept is not new, this
                    is the approach taken by Laravel and Symfony, and there are many good reasons for that.
                    The difference with the CakePHP feature factories and the other framework approach
                    lies in the powerful ORM and Event system.
                    Here I will show you a little feature of the factories.
                </aside>
            </section>
            <section data-background-color="#272A2A">
                <span style="display: block">
                    Unique fields
                    <span class="mini">testDetectDuplicateInBelongsToOneAssociation
                    </span>
                </span>

                <img src="assets/cakefest21/test_ff.png">
            </section>
        </section>
        <section data-background="http://i.giphy.com/7FrOU9tPbgAZtxV5mb.gif" data-background-interactive>
            <p class="white-shadowed">...exit the code</p>
        </section>
        <section>
            <p><a href="https://passbolt.com" target="_blank"><img style="height: 40px; margin: 40px 0" src="assets/passbolt.png"></a></p>
            <p class="fragment"><a href="https://github.com/passbolt/passbolt_api" target="_blank">Passbolt API</a></p>
            <p class="fragment"><a href="https://community.passbolt.com/" target="_blank">Community Forum</a></p>
            <p class="fragment"><a href="https://passbolt.crowdin.com/passbolt" target="_blank">Translation</a></p>
            <p class="fragment"><a href="https://github.com/vierge-noire/cakephp-test-suite-light/" target="_blank">Test Suite Light</a></p>
            <p class="fragment"><a href="https://github.com/vierge-noire/cakephp-fixture-factories/" target="_blank">Fixture Factories</a></p>
            <h2 class="fragment">Thank you <span class="cakephp">Bakers</span>!</h2>
            <aside class="notes">
                For those who did not know it yet, I hope you'll enjoy passbolt as a password manager in your life.
                Here is a link to the API, we are waiting for your contributions! It could inspire you just as you
                could inspire us.
            </aside>
        </section>
    </div>
</div>
<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/chart/Chart.min.js"></script>
<script src="plugin/chart/plugin.js"></script>
<script>

    $(function(){
        $(".baked-with-cakephp").html('<div class="float-right">\n' +
            '    <a href="https://book.cakephp.org/authentication/2/en/authenticators.html#jwt" target="_blank">\n' +
            '        <img src="http://www.cakephp.org/img/flags/Baked-with-CakePHP.png" width="150px;">\n' +
            '    </a>\n' +
            '</div>');
    });

    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,
        slideNumber: 'c/t',

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealChart ],


        chart: {
            defaults: {
                global: {
                    title: { fontColor: "#FFF" },
                    legend: {
                        labels: { fontColor: "#FFF" },
                    },
                },
                scale: {
                    scaleLabel: { fontColor: "#FFF" },
                    gridLines: { color: "#FFF", zeroLineColor: "#FFF" },
                    ticks: { fontColor: "#FFF" },
                }
            },
            line: { borderColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ], "borderDash": [ [5,10], [0,0] ]},
        },
    });
</script>
</body>
</html>
